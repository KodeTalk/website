<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
Design by Free CSS Templates
http://www.freecsstemplates.org
Released for free under a Creative Commons Attribution 2.5 License

Name       : ExtremeSurfing
Description: A two-column, fixed-width design with dark color scheme.
Version    : 1.0
Released   : 20120225

-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>Pengenalan Silex Part 3 - CRUD dengan Doctrine DBAL - Let&#039;s Talk About Code</title>
<link href="http://fonts.googleapis.com/css?family=Oswald" rel="stylesheet" type="text/css" />
<link href='http://fonts.googleapis.com/css?family=Arvo' rel='stylesheet' type='text/css'>
<link href="/css/style.css" rel="stylesheet" type="text/css" media="screen" />
</head>
<body>
<div id="wrapper">
  <div id="page">
    <div id="page-bgtop">
      <div id="page-bgbtm">
        <div id="page-content">
          <div id="header-wrapper">
            <div id="header">
              <div id="logo">
                <h1><a href="#">KodeTalk</a></h1>
                <p>Let&#039;s Talk About Code</p>
              </div>
            </div>
          </div>
          <!-- end #header -->
          <div id="menu-wrapper">
  <div id="menu">
    <ul>
              <li><a href="/index.html">Homepage</a></li>
              <li><a href="/tolkien.html">Tolkien</a></li>
          </ul>
  </div>
</div>
<!-- end #menu -->
<div id="banner"><img src="/images/banner.jpg" width="940" height="300" alt="" /></div>
          <div id="content">
            <div class="post">
	<h2 class="title"><a href="#">Pengenalan Silex Part 3 - CRUD dengan Doctrine DBAL</a></h2>
	<p class="meta">Posted by 
		<a href="#">Glend Maatita</a> on October 30, 2013 &nbsp;&bull;&nbsp;
				  <a href="/categories/php.html" class="permalink">Php</a> 
	  		  <a href="/categories/framework.html" class="permalink">Framework</a> 
	  		  <a href="/categories/silex.html" class="permalink">Silex</a> 
	  	</p>
	<div class="entry">
		<p><a href="http://www.doctrine-project.org/projects/dbal.html">Doctrine DBAL</a> atau Database Access Layer adalah bagian dari project Doctrine ORM yang hanya menyediakan abstraksi ke database dengan memanfaatkan PDO. Tidak seperti induk project nya, yaitu Doctrine ORM yang menyediakan berbagai macam fitur dan memakai arsitektur yang canggih yaitu Data Mapper, Doctrine DBAL lebih simple dan menyediakan hanya beberapa fungsionalitas dasar operasi database seperti database retrieval &amp; manipulation dengan memanfaatkan PDO, plus beberapa fitur tambahan seperti Query Builder untuk mempermudah kita menulis Query SQL.</p>

<p>Kita akan menggunakan DBAL yang sederhana ini untuk membuat aplikasi CRUD sederhana. Kita sudah membuat beberapa routing dan sekarang saatnya kita menulis code untuk menghandle masing-masing routing yang telah kita buat sebelumnya..</p>

<p><strong>Get All Users</strong></p>

<p>Kita akan menulis query untuk me-retrieve seluruh data user yang ada di database. Hasil query tersebut kita inject-an ke variable <strong>$app</strong>. Mekanisme detail tentang bagaimana kita bisa menginject-kan suatu value atau object ke variable <strong>$app</strong> ini akan kita bahas di artikel berikutnya</p>

<pre><code>$app-&gt;get('/users', function(Request $request) use($app) {
    $app['users'] = $app['db']-&gt;fetchAll('SELECT * FROM user');
    return $app['twig']-&gt;render('users/index.tpl', $app['data']);
});
</code></pre>

<p>Kita memanfaatkan method <strong>fetchAll</strong> yang terdapat pada Dbal dan mengisinya dengan query untuk meretrieve semua record dari table <em>user</em>. Perintah <em>fetchAll</em> dipanggil melalui <strong>$app['db']</strong> yang otomatis tersedia ketika me-register DBAL (lihat Part 2). Ini yang dinamakan <strong>Service Provider</strong> yang akan kita bahas di part berikutnya. Untuk sekarang, kita cukup tahu bahwa untuk menggunakan method2 dari DBAL, kita dapat memanggilnya via <strong>$app['db']</strong></p>

<p>Selain itu, kita juga memanggil Twig untuk merender view yaitu <strong>index.tpl</strong>. Ini juga menggunakan service provider</p>

<p><strong>New User</strong></p>

<p>Di routing ini, kita hanya akan merender form untuk memasukkan data user. Form yang akan kita gunakan adalah <strong>new.tpl</strong></p>

<pre><code>$app-&gt;get('/user/new', function(Request $request) use($app) {
    $app['form_title'] = 'New User';
    $app['form_action'] = '/users';
    $app['form'] = array(
        'nama' =&gt; '',
        'gender' =&gt; '',
        'email' =&gt; '',
        'telepon' =&gt; '',
        'alamat' =&gt; ''
    );
    return $app['twig']-&gt;render('user/new.tpl', $app['data']);
});
</code></pre>

<p><strong>Save User</strong></p>

<p>Kita akan simpan data user di routing ini</p>

<pre><code>$app-&gt;post('/admin/users', function(Request $request) use($app) {
    $app['db']-&gt;insert('user', array(
        'nama' =&gt; $request-&gt;request-&gt;get('nama'),
        'gender' =&gt; $request-&gt;request-&gt;get('gender'),
        'email' =&gt; $request-&gt;request-&gt;get('email'),
        'telepon' =&gt; $request-&gt;request-&gt;get('telepon'),
        'alamat' =&gt; $request-&gt;request-&gt;get('alamat')
        );
    return $app-&gt;redirect('//users');
});
</code></pre>

<p>Terlihat diatas, setelah kita simpan dengan menggunakan method dari Dbal yaitu <strong>insert</strong>, kita redirect ke halaman list users</p>

<p><strong>Show User</strong></p>

<p>Routing untuk ini akan me-retrieve data user dengan suatu ID dan menampilkan data user tersebut</p>

<pre><code>$app-&gt;get('/user/{id}/edit', function(Request $request, $id) use($app) {
    $app['user'] = $app['db']-&gt;fetchAssoc('SELECT * FROM user where id = ?', array($id));
    return $app['twig']-&gt;render('user/show.tpl', $app['data']);
});
</code></pre>

<p><strong>Edit User</strong></p>

<p>Routing untuk edit user akan me-retrieve data user dengan ID tertentu dan menampilkannya ke dalam form agar bisa diedit</p>

<pre><code>$app-&gt;get('/user/{id}/edit', function(Request $request, $id) use($app) {
    $user = $app['db']-&gt;fetchAssoc('SELECT * FROM user where id = ?', array($id));
    $app['form_title'] = 'Edit User';
    $app['form_action'] = '/user/' . $id;
    $app['form'] = array(
        'nama' =&gt; $user['nama'],
        'gender' =&gt; $$user['gender'],
        'email' =&gt; $user['email'],
        'telepon' =&gt; $user['telepon'],
        'alamat' =&gt; $user['alamat'],
        );
    return $app['twig']-&gt;render('user/edit.tpl', $app['data']);
});
</code></pre>

<p><strong>Update User</strong></p>

<p>Update user akan mengupdate data user dengan data yang telah diinput didalam form edit, kemudian meredirect routing ke halaman list user</p>

<pre><code>$app-&gt;post('/user/{id}', function(Request $request, $id) use($app) {
    $app['db']-&gt;update('user', array(
        'nama' =&gt; $request-&gt;request-&gt;get('nama'),
        'gender' =&gt; $request-&gt;request-&gt;get('gender'),
        'email' =&gt; $request-&gt;request-&gt;get('email'),
        'telepon' =&gt; $request-&gt;request-&gt;get('telepon'),
        'alamat' =&gt; $request-&gt;request-&gt;get('alamat')
        ), array('id' =&gt; $id));
    return $app-&gt;redirect('/users');
});
</code></pre>

<p><strong>Delete User</strong></p>

<p>Delete user akan menghapus record user dengan ID tertentu kemudian akan meredirect ke halaman list user</p>

<pre><code>$app-&gt;get('/user/{id}/delete', function(Request $request, $id) use($app) {
    $app['db']-&gt;delete('user', array('id' =&gt; $id));
    return $app-&gt;redirect('/users');
});
</code></pre>

<p>Yap, itulah isi routing untuk aplikasi restful sederhana untuk memanage data user. Part berikutnya kita akan mensetup view untuk operasi CRUD diatas dengan menggunakan Twig Template Engine</p>
 
	</div>
</div>
            <div style="clear: both;">&nbsp;</div>
          </div>
          <!-- end #content -->
          <div id="sidebar">
	<ul>
		<li>
			<h2>Situs apa sih ini?</h2>
			<p>KodeTalk adalah sebuah kumpulan tulisan seputar web development dan programming. Let's talk about code here.</p>
		</li>
		<li>
			<h2>Kategori</h2>
			<ul>
					      	<li><a href="/categories/php.html">Php</a></li>
	      	      	<li><a href="/categories/framework.html">Framework</a></li>
	      	      	<li><a href="/categories/silex.html">Silex</a></li>
	      	      	<li><a href="/categories/ruby.html">Ruby</a></li>
	      	      	<li><a href="/categories/notes.html">Notes</a></li>
	      	      	<li><a href="/categories/review.html">Review</a></li>
	      	      	<li><a href="/categories/git.html">Git</a></li>
	      	      	<li><a href="/categories/emacs.html">Emacs</a></li>
	      	      	<li><a href="/categories/linux.html">Linux</a></li>
	      	      	<li><a href="/categories/programming.html">Programming</a></li>
	      			</ul>
		</li>							
	</ul>
</div>
<!-- end #sidebar -->        </div>
        <div style="clear: both;">&nbsp;</div>
      </div>
    </div>
  </div>
  <!-- end #page -->
</div>
<div id="footer">
	<p>Copyright (c) 2012 KodeTalk.com. All rights reserved. Design by <a href="http://www.freecsstemplates.org/"> CSS Templates</a>.</p>
</div><!-- end #footer -->
</body>
</html>
